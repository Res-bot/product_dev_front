<div class="dashboard-container">
  <!-- Header -->
  <header class="dashboard-header">
    <div class="header-content">
      <h1>Employee Dashboard</h1>
      <p>Welcome, {{ employeeProfile.name }}</p>
    </div>
    <button class="logout-btn" (click)="onLogout()">
      <svg width="20" height="20" viewBox="0 0 20 20" fill="white">
        <path d="M13 3h-2v10h2V3zm4.83 2.17l-1.42 1.42C17.99 7.86 19 9.81 19 12c0 3.87-3.13 7-7 7s-7-3.13-7-7c0-2.19 1.01-4.14 2.58-5.42L6.17 5.17C4.23 6.82 3 9.26 3 12c0 4.97 4.03 9 9 9s9-4.03 9-9c0-2.74-1.23-5.18-3.17-6.83z"/>
      </svg>
      Logout
    </button>
  </header>

  <!-- Navigation Tabs -->
  <nav class="nav-tabs">
    <button 
      class="tab-btn" 
      [class.active]="activeTab === 'leave'"
      (click)="switchTab('leave')">
      Leave Management
    </button>
    <button 
      class="tab-btn" 
      [class.active]="activeTab === 'profile'"
      (click)="switchTab('profile')">
      My Profile
    </button>
  </nav>

  <!-- Main Content -->
  <main class="main-content">
    
    <!-- Success/Error Messages -->
    <div *ngIf="errorMessage" class="alert alert-error">
      {{ errorMessage }}
      <button class="alert-close" (click)="errorMessage = ''">×</button>
    </div>

    <div *ngIf="successMessage" class="alert alert-success">
      {{ successMessage }}
      <button class="alert-close" (click)="successMessage = ''">×</button>
    </div>

    <!-- LEAVE MANAGEMENT TAB -->
    <div *ngIf="activeTab === 'leave'" class="tab-content">
      
      <!-- Apply Leave Form -->
      <div class="card">
        <h2>Apply for New Leave</h2>
        <form (ngSubmit)="applyLeave()">
          <div class="form-grid">
            <div class="form-group">
              <label>Start Date *</label>
              <input 
                type="date" 
                [(ngModel)]="leaveForm.startDate" 
                name="startDate" 
                [min]="getTodayDate()"
                required>
              <small>Leave cannot start before today</small>
            </div>

            <div class="form-group">
              <label>End Date *</label>
              <input 
                type="date" 
                [(ngModel)]="leaveForm.endDate" 
                name="endDate" 
                [min]="leaveForm.startDate || getTodayDate()"
                required>
              <small>End date cannot be before start date</small>
            </div>
          </div>

          <div class="form-group">
            <label>Leave Type *</label>
            <select [(ngModel)]="leaveForm.type" name="type" required>
              <option value="SICK">Sick Leave</option>
              <option value="CASUAL">Casual Leave</option>
              <option value="ANNUAL">Annual Leave</option>
              <option value="VACATION">Vacation</option>
              <option value="PERSONAL">Personal Leave</option>
              <option value="EMERGENCY">Emergency Leave</option>
            </select>
          </div>

          <div class="form-group">
            <label>Reason *</label>
            <textarea 
              [(ngModel)]="leaveForm.reason" 
              name="reason" 
              rows="4" 
              placeholder="Please provide a detailed reason for your leave application..."
              maxlength="500"
              required></textarea>
            <small>Maximum 500 characters</small>
          </div>

          <div class="form-actions">
            <button type="submit" class="btn btn-primary" [disabled]="isLoading">
              <span *ngIf="isLoading">Submitting...</span>
              <span *ngIf="!isLoading">Submit Leave Application</span>
            </button>
            <button type="button" class="btn btn-secondary" (click)="resetForm()" [disabled]="isLoading">
              Clear Form
            </button>
          </div>
        </form>
      </div>

      <!-- Leave History -->
      <div class="card">
        <div class="card-header">
          <h2>Leave History</h2>
          <button class="btn-refresh" (click)="refreshLeaveHistory()" [disabled]="isLoading">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
              <path d="M8 3a5 5 0 104.546 2.914.5.5 0 00-.908-.417A4 4 0 118 4v1z"/>
              <path d="M8 0a.5.5 0 01.5.5v4a.5.5 0 01-.5.5H4.5a.5.5 0 010-1h3.293L6.646 2.854a.5.5 0 11.708-.708L8 2.793V.5A.5.5 0 018 0z"/>
            </svg>
            Refresh
          </button>
        </div>

        <!-- Loading -->
        <div *ngIf="isLoading && leaveHistory.length === 0" class="loading">
          <div class="spinner"></div>
          <p>Loading leave history...</p>
        </div>

        <!-- No History -->
        <div *ngIf="!isLoading && leaveHistory.length === 0" class="no-data">
          <p>No Leave History Found</p>
          <small>You haven't applied for any leaves yet.</small>
        </div>

        <!-- History Table -->
        <div *ngIf="leaveHistory.length > 0" class="table-container">
          <table>
            <thead>
              <tr>
                <th>Start Date</th>
                <th>End Date</th>
                <th>Duration</th>
                <th>Type</th>
                <th>Reason</th>
                <th>Applied On</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let leave of leaveHistory">
                <td>{{ formatDate(leave.startDate || '') }}</td>
                <td>{{ formatDate(leave.endDate || '') }}</td>
                <td>{{ calculateDuration(leave.startDate || '', leave.endDate || '') }} days</td>
                <td>{{ getLeaveTypeDisplay(leave.type || '') }}</td>
                <td class="reason-cell" [title]="leave.reason || ''">
                  {{ (leave.reason && leave.reason.length > 50) ? (leave.reason | slice:0:50) + '...' : (leave.reason || 'N/A') }}
                </td>
                <td>{{ formatDate(leave.requestedOn || '') }}</td>
                <td>
                  <span [class]="getStatusBadgeClass(leave.status || '')">
                    {{ getStatusDisplayText(leave.status || '') }}
                  </span>
                  <div *ngIf="leave.rejectionReason" class="rejection-reason">
                    <small>{{ leave.rejectionReason }}</small>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>

          <!-- Summary -->
          <div class="summary">
            <div class="summary-item">
              <span class="summary-label">Pending:</span>
              <span class="summary-value">{{ getPendingCount() }}</span>
            </div>
            <div class="summary-item">
              <span class="summary-label">Approved:</span>
              <span class="summary-value">{{ getApprovedCount() }}</span>
            </div>
            <div class="summary-item">
              <span class="summary-label">Rejected:</span>
              <span class="summary-value">{{ getRejectedCount() }}</span>
            </div>
            <div class="summary-item">
              <span class="summary-label">Total:</span>
              <span class="summary-value">{{ leaveHistory.length }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- PROFILE TAB -->
    <div *ngIf="activeTab === 'profile'" class="tab-content">
      <div class="card">
        <h2>My Profile</h2>

        <!-- Loading -->
        <div *ngIf="isLoadingProfile" class="loading">
          <div class="spinner"></div>
          <p>Loading profile...</p>
        </div>

        <!-- Profile Content -->
        <div *ngIf="!isLoadingProfile" class="profile-content">
          <div class="profile-header">
            <div class="profile-avatar">
              {{ employeeProfile.name.charAt(0).toUpperCase() }}
            </div>
            <div class="profile-info">
              <h3>{{ employeeProfile.name }}</h3>
              <p>{{ employeeProfile.role }}</p>
            </div>
          </div>

          <div class="profile-details">
            <div class="detail-group">
              <label>Full Name</label>
              <p>{{ employeeProfile.name }}</p>
            </div>

            <div class="detail-group">
              <label>Email Address</label>
              <p>{{ employeeProfile.email }}</p>
            </div>

            <div class="detail-group">
              <label>Employee ID</label>
              <p>{{ employeeProfile.employeeId || 'N/A' }}</p>
            </div>

            <div class="detail-group">
              <label>Department</label>
              <p>{{ employeeProfile.department || 'N/A' }}</p>
            </div>

            <div class="detail-group">
              <label>Position</label>
              <p>{{ employeeProfile.position || 'N/A' }}</p>
            </div>

            <div class="detail-group">
              <label>Join Date</label>
              <p>{{ employeeProfile.joinDate || 'N/A' }}</p>
            </div>

            <div class="detail-group">
              <label>Phone Number</label>
              <p>{{ employeeProfile.phone || 'N/A' }}</p>
            </div>

            <div class="detail-group">
              <label>Role</label>
              <p>{{ employeeProfile.role }}</p>
            </div>
          </div>
        </div>
      </div>
    </div>

  </main>
</div>