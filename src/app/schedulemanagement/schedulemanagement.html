<div class="schedule-management">
  <!-- Header -->
  <div class="page-header">
    <div>
      <h1 class="page-title">üìÖ Schedule Management</h1>
      <p class="page-subtitle">Manage class schedules and timetables</p>
    </div>
    <button class="btn-primary" (click)="openAddModal()">
      <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
        <path d="M10 5v10M5 10h10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>
      Add Schedule
    </button>
  </div>

  <!-- Success Message -->
  <div *ngIf="successMessage" class="alert alert-success">
    <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
      <path d="M10 0C4.477 0 0 4.477 0 10s4.477 10 10 10 10-4.477 10-10S15.523 0 10 0zm4.707 7.707l-5 5a1 1 0 01-1.414 0l-2.5-2.5a1 1 0 011.414-1.414L9 10.586l4.293-4.293a1 1 0 011.414 1.414z"/>
    </svg>
    {{ successMessage }}
  </div>

  <!-- Error Message -->
  <div *ngIf="error" class="alert alert-error">
    <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
      <path d="M10 0C4.477 0 0 4.477 0 10s4.477 10 10 10 10-4.477 10-10S15.523 0 10 0zm1 14H9v-2h2v2zm0-4H9V6h2v4z"/>
    </svg>
    {{ error }}
  </div>

  <!-- Loading Overlay -->
  <div *ngIf="isLoading" class="loading-overlay">
    <div class="spinner"></div>
    <p>Loading...</p>
  </div>

  <!-- View Toggle -->
  <div class="view-toggle">
    <button 
      class="toggle-btn" 
      [class.active]="viewMode === 'table'"
      (click)="setViewMode('table')">
      üìä Table View
    </button>
    <button 
      class="toggle-btn" 
      [class.active]="viewMode === 'timetable'"
      (click)="setViewMode('timetable')">
      üìÖ Timetable View
    </button>
  </div>

  <!-- TABLE VIEW -->
  <div *ngIf="viewMode === 'table'" class="table-container">
    <table class="schedule-table">
      <thead>
        <tr>
          <th>Day</th>
          <th>Time</th>
          <th>Course</th>
          <th>Teacher</th>
          <th>Room</th>
          <th>Batch</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let schedule of schedules" class="schedule-row">
          <td>
            <span class="day-badge">{{ schedule.dayOfWeek }}</span>
          </td>
          <td class="time-cell">
            {{ schedule.startTime }} - {{ schedule.endTime }}
          </td>
          <td>
            <div class="course-info">
              <strong>{{ schedule.courseCode }}</strong>
              <span>{{ schedule.courseName }}</span>
            </div>
          </td>
          <td>
            <div class="teacher-info">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                <circle cx="8" cy="5" r="2"/>
                <path d="M3 13c0-2.761 2.239-5 5-5s5 2.239 5 5"/>
              </svg>
              {{ schedule.teacherName }}
            </div>
          </td>
          <td>{{ schedule.roomNumber || '-' }}</td>
          <td>{{ schedule.batch || '-' }}</td>
          <td>
            <div class="action-buttons">
              <button class="btn-icon btn-edit" (click)="openEditModal(schedule)" title="Edit">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                  <path d="M12.146 1.854a.5.5 0 01.708 0l1.292 1.292a.5.5 0 010 .708l-9 9a.5.5 0 01-.168.11l-4 1.5a.5.5 0 01-.63-.63l1.5-4a.5.5 0 01.11-.168l9-9z"/>
                </svg>
              </button>
              <button class="btn-icon btn-delete" (click)="openDeleteModal(schedule)" title="Delete">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                  <path d="M5.5 1a.5.5 0 01.5.5V2h4v-.5a.5.5 0 011 0V2h1.5a.5.5 0 010 1H13v10a1 1 0 01-1 1H4a1 1 0 01-1-1V3h-.5a.5.5 0 010-1H4v-.5a.5.5 0 01.5-.5zM6 4.5v7a.5.5 0 001 0v-7a.5.5 0 00-1 0zm3 0v7a.5.5 0 001 0v-7a.5.5 0 00-1 0z"/>
                </svg>
              </button>
            </div>
          </td>
        </tr>
        <tr *ngIf="schedules.length === 0">
          <td colspan="7" class="empty-state">
            <div class="empty-message">
              <svg width="48" height="48" viewBox="0 0 48 48" fill="none">
                <rect x="8" y="8" width="32" height="32" rx="2" stroke="currentColor" stroke-width="2"/>
                <path d="M16 8v32M32 8v32M8 16h32M8 32h32" stroke="currentColor" stroke-width="2"/>
              </svg>
              <p>No schedules found</p>
              <button class="btn-secondary" (click)="openAddModal()">Add Your First Schedule</button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- TIMETABLE VIEW -->
  <div *ngIf="viewMode === 'timetable'" class="timetable-view">
    <!-- Day Selector -->
    <div class="day-selector">
      <button 
        *ngFor="let day of days"
        class="day-btn"
        [class.active]="selectedDay === day"
        (click)="selectDay(day)">
        {{ day }}
      </button>
    </div>

    <!-- Timetable Grid -->
    <div class="timetable-grid">
      <div *ngFor="let schedule of getSchedulesForDay(selectedDay)" class="schedule-card">
        <div class="schedule-card-header">
          <div class="time-badge">
            {{ schedule.startTime }} - {{ schedule.endTime }}
          </div>
          <div class="action-buttons">
            <button class="btn-icon-small" (click)="openEditModal(schedule)">
              <svg width="14" height="14" viewBox="0 0 14 14" fill="currentColor">
                <path d="M10.646 1.354a.5.5 0 01.708 0l1.292 1.292a.5.5 0 010 .708l-8 8a.5.5 0 01-.168.11l-3 1a.5.5 0 01-.63-.63l1-3a.5.5 0 01.11-.168l8-8z"/>
              </svg>
            </button>
            <button class="btn-icon-small btn-delete" (click)="openDeleteModal(schedule)">
              <svg width="14" height="14" viewBox="0 0 14 14" fill="currentColor">
                <path d="M4.5 1a.5.5 0 01.5.5V2h4v-.5a.5.5 0 011 0V2h1a.5.5 0 010 1h-.5v8a1 1 0 01-1 1H4a1 1 0 01-1-1V3h-.5a.5.5 0 010-1H3v-.5a.5.5 0 01.5-.5z"/>
              </svg>
            </button>
          </div>
        </div>
        <div class="schedule-card-body">
          <h3 class="course-title">{{ schedule.courseCode }}</h3>
          <p class="course-name">{{ schedule.courseName }}</p>
          <div class="schedule-meta">
            <div class="meta-item">
              <svg width="14" height="14" viewBox="0 0 14 14" fill="currentColor">
                <circle cx="7" cy="4" r="2"/>
                <path d="M2 12c0-2.761 2.239-5 5-5s5 2.239 5 5"/>
              </svg>
              {{ schedule.teacherName }}
            </div>
            <div class="meta-item" *ngIf="schedule.roomNumber">
              <svg width="14" height="14" viewBox="0 0 14 14" fill="currentColor">
                <rect x="2" y="2" width="10" height="10" rx="1" stroke="currentColor" stroke-width="1.5" fill="none"/>
              </svg>
              {{ schedule.roomNumber }}
            </div>
            <div class="meta-item" *ngIf="schedule.batch">
              <svg width="14" height="14" viewBox="0 0 14 14" fill="currentColor">
                <path d="M3 3h8v2H3zM3 6h8v2H3zM3 9h5v2H3z"/>
              </svg>
              {{ schedule.batch }}
            </div>
          </div>
        </div>
      </div>

      <div *ngIf="getSchedulesForDay(selectedDay).length === 0" class="empty-day">
        <svg width="64" height="64" viewBox="0 0 64 64" fill="none">
          <rect x="12" y="12" width="40" height="40" rx="4" stroke="currentColor" stroke-width="2"/>
          <path d="M20 12v40M44 12v40M12 24h40M12 44h40" stroke="currentColor" stroke-width="2"/>
        </svg>
        <p>No classes scheduled for {{ selectedDay }}</p>
        <button class="btn-primary" (click)="openAddModal()">Add Schedule</button>
      </div>
    </div>
  </div>

  <!-- ADD SCHEDULE MODAL -->
  <div *ngIf="showAddModal" class="modal-overlay" (click)="closeModals()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>‚ûï Add New Schedule</h2>
        <button class="btn-close" (click)="closeModals()">√ó</button>
      </div>
      <div class="modal-body">
        <form (ngSubmit)="createSchedule()">
          <div class="form-row">
            <div class="form-group">
              <label>Day of Week *</label>
              <select [(ngModel)]="scheduleForm.dayOfWeek" name="dayOfWeek" class="form-control" required>
                <option *ngFor="let day of days" [value]="day">{{ day }}</option>
              </select>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Start Time *</label>
              <select [(ngModel)]="scheduleForm.startTime" name="startTime" class="form-control" required>
                <option *ngFor="let time of timeSlots" [value]="time">{{ time }}</option>
              </select>
            </div>
            <div class="form-group">
              <label>End Time *</label>
              <select [(ngModel)]="scheduleForm.endTime" name="endTime" class="form-control" required>
                <option *ngFor="let time of timeSlots" [value]="time">{{ time }}</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label>Course *</label>
            <select 
              [(ngModel)]="scheduleForm.courseId" 
              name="courseId" 
              class="form-control" 
              (change)="onCourseChange()"
              required>
              <option [value]="0">Select a course</option>
              <option *ngFor="let course of courses" [value]="course.id">
                {{ course.courseCode }} - {{ course.name }}
              </option>
            </select>
          </div>

          <div class="form-group">
            <label>Teacher *</label>
            <select [(ngModel)]="scheduleForm.teacherId" name="teacherId" class="form-control" required>
              <option [value]="0">Select a teacher</option>
              <option *ngFor="let teacher of teachers" [value]="teacher.id">
                {{ teacher.name }} ({{ teacher.department }})
              </option>
            </select>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Room Number</label>
              <input 
                type="text" 
                [(ngModel)]="scheduleForm.roomNumber" 
                name="roomNumber" 
                class="form-control" 
                placeholder="e.g., AR-406">
            </div>
            <div class="form-group">
              <label>Batch</label>
              <input 
                type="text" 
                [(ngModel)]="scheduleForm.batch" 
                name="batch" 
                class="form-control" 
                placeholder="e.g., BCA 5th A">
            </div>
          </div>

          <div class="form-group">
            <label>Notes</label>
            <textarea 
              [(ngModel)]="scheduleForm.notes" 
              name="notes" 
              class="form-control" 
              rows="3"
              placeholder="Additional notes..."></textarea>
          </div>

          <div class="modal-footer">
            <button type="button" class="btn-secondary" (click)="closeModals()">Cancel</button>
            <button type="submit" class="btn-primary">Create Schedule</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- EDIT SCHEDULE MODAL -->
  <div *ngIf="showEditModal" class="modal-overlay" (click)="closeModals()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>‚úèÔ∏è Edit Schedule</h2>
        <button class="btn-close" (click)="closeModals()">√ó</button>
      </div>
      <div class="modal-body">
        <form (ngSubmit)="updateSchedule()">
          <div class="form-row">
            <div class="form-group">
              <label>Day of Week *</label>
              <select [(ngModel)]="scheduleForm.dayOfWeek" name="dayOfWeek" class="form-control" required>
                <option *ngFor="let day of days" [value]="day">{{ day }}</option>
              </select>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Start Time *</label>
              <select [(ngModel)]="scheduleForm.startTime" name="startTime" class="form-control" required>
                <option *ngFor="let time of timeSlots" [value]="time">{{ time }}</option>
              </select>
            </div>
            <div class="form-group">
              <label>End Time *</label>
              <select [(ngModel)]="scheduleForm.endTime" name="endTime" class="form-control" required>
                <option *ngFor="let time of timeSlots" [value]="time">{{ time }}</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label>Course *</label>
            <select 
              [(ngModel)]="scheduleForm.courseId" 
              name="courseId" 
              class="form-control" 
              (change)="onCourseChange()"
              required>
              <option [value]="0">Select a course</option>
              <option *ngFor="let course of courses" [value]="course.id">
                {{ course.courseCode }} - {{ course.name }}
              </option>
            </select>
          </div>

          <div class="form-group">
            <label>Teacher *</label>
            <select [(ngModel)]="scheduleForm.teacherId" name="teacherId" class="form-control" required>
              <option [value]="0">Select a teacher</option>
              <option *ngFor="let teacher of teachers" [value]="teacher.id">
                {{ teacher.name }} ({{ teacher.department }})
              </option>
            </select>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Room Number</label>
              <input 
                type="text" 
                [(ngModel)]="scheduleForm.roomNumber" 
                name="roomNumber" 
                class="form-control" 
                placeholder="e.g., AR-406">
            </div>
            <div class="form-group">
              <label>Batch</label>
              <input 
                type="text" 
                [(ngModel)]="scheduleForm.batch" 
                name="batch" 
                class="form-control" 
                placeholder="e.g., BCA 5th A">
            </div>
          </div>

          <div class="form-group">
            <label>Notes</label>
            <textarea 
              [(ngModel)]="scheduleForm.notes" 
              name="notes" 
              class="form-control" 
              rows="3"
              placeholder="Additional notes..."></textarea>
          </div>

          <div class="modal-footer">
            <button type="button" class="btn-secondary" (click)="closeModals()">Cancel</button>
            <button type="submit" class="btn-primary">Update Schedule</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- DELETE CONFIRMATION MODAL -->
  <div *ngIf="showDeleteModal" class="modal-overlay" (click)="closeModals()">
    <div class="modal-content modal-small" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>üóëÔ∏è Delete Schedule</h2>
        <button class="btn-close" (click)="closeModals()">√ó</button>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to delete this schedule?</p>
        <div class="delete-info" *ngIf="scheduleToDelete">
          <p><strong>Course:</strong> {{ scheduleToDelete.courseName }}</p>
          <p><strong>Day:</strong> {{ scheduleToDelete.dayOfWeek }}</p>
          <p><strong>Time:</strong> {{ scheduleToDelete.startTime }} - {{ scheduleToDelete.endTime }}</p>
        </div>
        <div class="modal-footer">
          <button class="btn-secondary" (click)="closeModals()">Cancel</button>
          <button class="btn-danger" (click)="confirmDelete()">Delete</button>
        </div>
      </div>
    </div>
  </div>
</div>